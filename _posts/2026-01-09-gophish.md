---
layout: post
title: "Sensibilisation : La 2FA Ne Suffit Plus : Installation et Configuration de Gophish sur Ubuntu (S√©rie - √âp.1)"
date: 2025-01-01 09:00:00 +0100
categories: [cybers√©curit√©, phishing, tutoriel,sensibilisation]
tags: [gophish, 2fa, authentification, s√©curit√©, ubuntu, vps]
author: korpstation
image: /assets/posts/gophish/2FA.jpeg
toc: true
---

# Installation de Gophish sur Ubuntu VPS

## Qu'est-ce que Gophish ?

Gophish est un framework open-source con√ßu pour les campagnes de sensibilisation au phishing.

**Fonctionnalit√©s principales :**
- Cr√©ation d'emails de phishing personnalis√©s
- Clonage de pages web
- Tracking des clics et des soumissions de donn√©es
- Dashboard analytics en temps r√©el

> **IMPORTANT :** Gophish est un outil L√âGAL con√ßu pour la formation. Son utilisation contre des tiers sans autorisation est ILL√âGALE.

## Pr√©requis

Avant de commencer, je recommande d'avoir :

- Un VPS (Dans le cadre de ce tutoriel je suis sous Ubuntu)
- Un domaine configur√© chez votre founisseur
- Connaissances de base en ligne de commande Linux

### √âtape 1 : Mise √† jour du syst√®me

Connectez-vous √† votre VPS :

```bash
sudo apt update && sudo apt upgrade -y
sudo apt full-upgrade -y
sudo apt autoremove -y
sudo apt clean
```

**Explication :** Ces commandes mettent √† jour la liste des paquets, installent les mises √† jour, nettoient les paquets inutiles.

### √âtape 2 : Installation des d√©pendances

Installez les outils n√©cessaires :

```bash
sudo apt install -y wget unzip
```

- `wget` : Pour t√©l√©charger Gophish
- `unzip` : Pour extraire l'archive

### √âtape 3 : Configuration du pare-feu

Configurez UFW (Uncomplicated Firewall) :

```bash
# Activer UFW
sudo ufw enable

# Autoriser HTTP (port 80)
sudo ufw allow 80/tcp

# Autoriser HTTPS (port 443)
sudo ufw allow 443/tcp

# Autoriser l'interface admin Gophish (port 3333)
sudo ufw allow 3333/tcp

# V√©rifier le statut
sudo ufw status verbose
```

**R√©sultat attendu :**

```
root@srv.......:~# ufw status verbose
Status: active


To                         Action      From
--                         ------      ----
80/tcp                     ALLOW IN    Anywhere                  
443/tcp                    ALLOW IN    Anywhere                  
3333/tcp                   ALLOW IN    Anywhere                  
80/tcp (v6)                ALLOW IN    Anywhere (v6)             
443/tcp (v6)               ALLOW IN    Anywhere (v6)             
3333/tcp (v6)              ALLOW IN    Anywhere (v6) 
```

### √âtape 4 : T√©l√©chargement de Gophish

T√©l√©chargez la derni√®re version de Gophish :

```bash
# Aller dans /tmp
cd /tmp

# T√©l√©charger Gophish (version 0.12.1 - C'est la derni√®re stable)
wget https://github.com/gophish/gophish/releases/download/v0.12.1/gophish-v0.12.1-linux-64bit.zip

```

### √âtape 5 : Installation de Gophish

D√©compressez et installez Gophish dans `/opt` :

```bash
# D√©compresser
root@srv....:/tmp# unzip gophish-v0.12.1-linux-64bit.zip -d /opt/gophish
Command 'unzip' not found, but can be installed with:
apt install unzip
root@srv.....:/tmp# apt install unzip 
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Suggested packages:
  zip
The following NEW packages will be installed:
  unzip
0 upgraded, 1 newly installed, 0 to remove and 1 not upgraded.

#lancer l'installation
root@srv.....:/tmp# unzip gophish-v0.12.1-linux-64bit.zip -d /opt/gophish
Archive:  gophish-v0.12.1-linux-64bit.zip
  inflating: /opt/gophish/gophish    
   creating: /opt/gophish/static/js/dist/
   creating: /opt/gophish/static/js/dist/app/
..................

# Rendre Gophish ex√©cutable
sudo chmod +x /opt/gophish/gophish

# V√©rifier les fichiers
root@srv1105586:# ls -lh /opt/gophish/
total 21M
-rw-r--r-- 1 root root 1.1K Sep 14  2022 LICENSE
-rw-r--r-- 1 root root 3.3K Sep 14  2022 README.md
-rw-r--r-- 1 root root    7 Sep 14  2022 VERSION
-rw-r--r-- 1 root root  460 Sep 14  2022 config.json
drwxr-xr-x 4 root root 4.0K Sep 14  2022 db
-rw-r--r-- 1 root root  21M Sep 14  2022 gophish
drwxr-xr-x 7 root root 4.0K Jan  6  2131 static
drwxr-xr-x 2 root root 4.0K Sep 14  2022 templates
```

**Fichiers pr√©sents :**
- `gophish` : Ex√©cutable principal
- `config.json` : Fichier de configuration
- Dossiers : `static/`, `templates/`, `db/`

### √âtape 6 : Premier lancement et r√©cup√©ration du mot de passe

Lancez Gophish pour la premi√®re fois :

```bash
root@srv1105586:/opt/gophish# ./gophish 
time="2026-01-06T21:45:44Z" level=warning msg="No contact address has been configured."
time="2026-01-06T21:45:44Z" level=warning msg="Please consider adding a contact_address entry in your config.json"
goose: migrating db environment 'production', current version: 0, target: 20220321133237
OK    20160118194630_init.sql
OK    20160131153104_0.1.2_add_event_details.sql
OK    20160211211220_0.1.2_add_ignore_cert_errors.sql
OK    20160217211342_0.1.2_create_from_col_results.sql
 ...............
 ...............

```
**R√©sultat attendu :**

```bash
time="2026-01-06T21:45:45Z" level=info msg="Please login with the username admin and the password 1b1e96935e46e6cd"
time="2026-01-06T21:45:45Z" level=info msg="Creating new self-signed certificates for administration interface"
time="2026-01-06T21:45:45Z" level=info msg="Background Worker Started Successfully - Waiting for Campaigns"
time="2026-01-06T21:45:45Z" level=info msg="Starting IMAP monitor manager"
time="2026-01-06T21:45:45Z" level=info msg="Starting phishing server at http://0.0.0.0:80"
time="2026-01-06T21:45:45Z" level=info msg="Starting new IMAP monitor for user admin"
time="2026-01-06T21:45:45Z" level=fatal msg="listen tcp 0.0.0.0:80: bind: address already in use"

```

> **üîë IMPORTANT :** Notez le mot de passe qui s'affiche (dans mon cas c'est 1b1e96935e46e6cd). Gophish gen√®re un nouveau mot de passe lors du premier lancement de gophish. 

>**Probl√®me Eventuel**

Lors du premier lancement si vous avez comme moi cette erreur `level=fatal msg="listen tcp 0.0.0.0:80: bind: address already in use"` ne vous en faites pas. 

C'est juste que Gophish selon sa config par d√©faut d√©marre sur le port 80 qui est g√©n√©ralement utilis√© par nginx si est elle active. Donc nous allons modifier la config. 

### √âtape 7 : Configuration de Gophish

√âditez le fichier de configuration :

```bash
sudo nano /opt/gophish/config.json
```

**Configuration recommand√©e :**

```json
root@srv.....:/opt/gophish# cat config.json 
{
    "admin_server": {
        "listen_url": "0.0.0.0:3333",
        "use_tls": true,
        "cert_path": "gophish_admin.crt",
        "key_path": "gophish_admin.key",
        "trusted_origins": []
    },
    "phish_server": {
        "listen_url": "0.0.0.0:3334",
        "use_tls": false,
        "cert_path": "phish.crt",
        "key_path": "phish.key"
    },
    "db_name": "sqlite3",
    "db_path": "gophish.db",
    "migrations_prefix": "db/db_",
    "contact_address": "",
    "logging": {
        "filename": "",
        "level": ""
    }
}
```

**Explication :**

- `admin_server.listen_url` : `0.0.0.0:3333` permet l'acc√®s depuis l'ext√©rieur sur le port 3333 √† gophish.  
- `admin_server.use_tls` : `true` pour s√©curiser l'interface admin en HTTPS
- `phish_server.listen_url` : `0.0.0.0:3334` pour nos campagnes de phishing.
- `phish_server.use_tls` : `false` car les certificats auto-sign√©s alertent les utilisateurs. 

> Sauvegardez avec `Ctrl+X`, puis `Y`, puis `Entr√©e`.


### √âtape 8 : Cr√©ation du service systemd

Nous allons cr√©er un service pour lancer Gophish automatiquement au d√©marrage :

```bash
sudo nano /etc/systemd/system/gophish.service
```

**Contenu du fichier :**

```ini
[Unit]
Description=Gophish 
After=network.target

[Service]
Type=simple
User=root
Group=root
WorkingDirectory=/opt/gophish
ExecStart=/opt/gophish/gophish
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**Explication :**

- `After=network.target` : Lance Gophish apr√®s le r√©seau
- `WorkingDirectory=/opt/gophish` : R√©pertoire de travail
- `ExecStart=/opt/gophish/gophish` : Commande √† ex√©cuter
- `Restart=always` : Red√©marre automatiquement en cas d'arr√™t
- `RestartSec=10` : Attend 10 secondes avant de red√©marrer

Sauvegardez et activez le service :

```bash
# Recharger systemd
sudo systemctl daemon-reload

# D√©marrer Gophish
sudo systemctl start gophish

# Activer au d√©marrage
sudo systemctl enable gophish

# V√©rifier le statut
sudo systemctl status gophish
```

**R√©sultat attendu :**

``` bash
root@......:/opt/gophish# systemctl status gophish
‚óè gophish.service - Gophish
     Loaded: loaded (/etc/systemd/system/gophish.service; enabled; preset: enab>
     Active: active (running) since Wed 2026-01-07 00:36:48 UTC; 25s ago
   Main PID: 2472 (gophish)
      Tasks: 8 (limit: 9483)
     Memory: 7.5M (peak: 7.9M)
        CPU: 102ms
     CGroup: /system.slice/gophish.service
             ‚îî‚îÄ2472 /opt/gophish/gophish
```

### √âtape 9 : R√©cup√©ration du nouveau mot de passe

Apr√®s le red√©marrage avec systemd, un nouveau mot de passe pour le compte admin est g√©n√©r√©. Ex√©cutez la commande suivante pour la r√©cup√©rer :

```bash
sudo journalctl -u gophish.service | grep "password"
```

**Exemple de r√©sultat :**

```bash
root@.....:/opt/gophish# journalctl -u gophish.service | grep "password"
Jan 07 00:36:48 srv..... gophish[2472]: time="2026-01-07T00:36:48Z" level=info msg="Please login with the username admin and the password 55f3face75121fac"

```

Notez le mot de passe : `55f3face75121fac`


### √âtape 10 : Premi√®re connexion au dashboard

Ouvrez un navigateur et acc√©dez √† :

```
https://VOTRE_IP_VPS:3333
```

Exemple : `https://203.0.113.45:3333`

**Vous verrez un avertissement de certificat SSL** (c'est normal, c'est un certificat auto-sign√©).

**Sur Chrome/Edge :** Cliquez sur "Avanc√©" puis "Continuer vers le site (non s√©curis√©)"  
**Sur Firefox :** Cliquez sur "Avanc√©" puis "Accepter le risque et continuer"

**Identifiants de connexion :**
- Username : `admin`
- Password : Le mot de passe r√©cup√©r√© √† l'√©tape 9

![Interface de connexion Gophish](/assets/posts/gophish/login.png)


### √âtape 11 : Changement du mot de passe

**Apr√®s la premi√®re connexion gophish vous redirige vers une page pour modifier votre mot de passe admin:**

![Modificaiton mot de passe](/assets/posts/gophish/changepass.png)

**Recommandation :** Selon notre configuration actuelle, notre interface admin est accessible directement depuis internet. Donc je vous recommande d'utiliser un mot de passe vraiment fort.

### √âtape 12 : Exploration de l'interface

Vous devriez maintenant voir le dashboard Gophish avec :

- **Dashboard** : Vue d'ensemble des campagnes
- **Campaigns** : Cr√©er et g√©rer vos campagnes
- **Users & Groups** : G√©rer les cibles
- **Email Templates** : Cr√©er les emails de phishing
- **Landing Pages** : Cr√©er les pages de capture
- **Sending Profiles** : Configurer SMTP

**‚úÖ F√©licitations ! Gophish est op√©rationnel sur votre VPS. Nous y reviendrons pour mettre en place nos campagnes**

---



## 8. Troubleshooting


### Probl√®me : "Cannot access admin interface"

**V√©rifications :**

```bash
# 1. V√©rifier que Gophish est actif
sudo systemctl status gophish

# 2. V√©rifier que le port 3333 est ouvert
sudo ufw status | grep 3333

# 3. V√©rifier les logs
sudo journalctl -u gophish.service -n 50
```

### Probl√®me : "Password not working"

**Solution :**

```bash
# Arr√™ter Gophish
sudo systemctl stop gophish

# Supprimer la base de donn√©es 
sudo rm /opt/gophish/gophish.db

# Red√©marrer Gophish
sudo systemctl start gophish

# R√©cup√©rer le nouveau mot de passe
sudo journalctl -u gophish.service | grep "password"
```


## 9. Prochaines √âtapes

Dans le prochain √©pisode nous allons **[Publier Gophish en HTTPS avec un reverse proxy Nginx](https://korpstation.github.io/posts/reverseproxy/)**.




---

## ‚ö†Ô∏è Disclaimer L√©gal et √âthique

Cette s√©rie est r√©alis√©e √† des fins **STRICTEMENT p√©dagogiques** et de sensibilisation √† la cybers√©curit√©.

Toutes les d√©monstrations sont effectu√©es dans un environnement contr√¥l√© et isol√©, sur mes propres comptes de test dont je suis le propri√©taire l√©gitime.

**L'utilisation de ces techniques contre des tiers sans autorisation explicite est ILL√âGALE.**


---
